<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Repository</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- IAAC Design System -->
  <link rel="stylesheet" href="/iaac-repo/design-system/design-system.css" />

  <style>
    /* ---------- page tweaks ---------- */
    body { margin:0; background:#fff; }
    header.hero {
      background:#E24E36; color:#fff;
      padding: var(--space-lg) var(--space-md);
    }
    header.hero .content { max-width:1200px; }
    header h1 {
      font-family: var(--font-display, 'Abril Fatface', serif);
      font-weight:400; color:#fff;
      font-size: clamp(2.1rem, 4vw, 3rem);
      margin:.2rem 0 .4rem;
    }
    header p { max-width:64ch; color:#fff; opacity:.95; }

    main .content { max-width:1200px; }

    .controls {
      display:grid;
      grid-template-columns: 260px 1fr 140px;
      gap: var(--space-md);
      align-items:center;
      margin: var(--space-md) 0 var(--space-lg);
    }
    @media (max-width:900px){
      .controls{ grid-template-columns: 1fr; }
    }

    select, input[type="search"]{
      padding: .7rem .8rem;
      border-radius: 8px;
      border:1px solid var(--color-border);
      font: inherit;
      background:#fff;
    }
    .count { text-align:right; opacity:.7; }
    @media (max-width:900px){ .count{ text-align:left; } }

    .grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); }
    @media (max-width:1024px){ .grid{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width:640px){ .grid{ grid-template-columns: 1fr; } }

    .card {
      background: #fff;
      border-radius: var(--radius-card);
      border:1px solid var(--color-border);
      box-shadow: 0 2px 12px var(--color-shadow);
      overflow: hidden;
      display:flex; flex-direction:column;
    }
        .card-body { padding: var(--space-md); display:flex; flex-direction:column; gap:.5rem; }
    .badge {
      display:inline-block; padding:.25rem .6rem; border-radius:999px;
      font-size:.8rem; font-weight:700; background:#faf6e3; color:#7a5d00;
      border:1px solid #f1e6b1;
    }
    .title { font-weight:700; font-size:1.05rem; margin:0; }
    .meta { font-size:.9rem; opacity:.75; }
    .card-actions { margin-top:auto; }
    .primary-btn { width:100%; text-align:center; }
    .empty { opacity:.7; padding:2rem 0; }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <div class="content">
      <h1>Repository</h1>
      <p>
        Browse all deliverables I’ve created across courses. Use the filter to switch
        between courses; each card links to the corresponding page.
      </p>
    </div>
  </header>

  <!-- GALLERY -->
  <main>
    <div class="content">

      <div class="controls">
        <select id="courseFilter" aria-label="Filter by course">
          <!-- options injected by JS -->
        </select>

        <input id="searchBox" type="search" placeholder="Search titles or tags…" aria-label="Search">

        <div class="count" id="resultCount">0 items</div>
      </div>

      <div id="gallery" class="grid" aria-live="polite"></div>
      <div id="emptyState" class="empty" hidden>No items match your filter.</div>

    </div>
  </main>

  <script>
    /* ========== DATA: add your deliverables here ========== */
   const fs = require('fs');
const path = require('path');

const coursesDir = './repository/courses';
const deliverables = [];

fs.readdirSync(coursesDir).forEach(courseFolder => {
  const coursePath = path.join(coursesDir, courseFolder);
  fs.readdirSync(coursePath)
    .filter(f => f.endsWith('.html'))
    .forEach(file => {
      deliverables.push({
        title: getTitleFromFile(file), // You may want to parse <title> from each file
        course: decodeURIComponent(courseFolder),
        href: `/iaac-repo/repository/courses/${encodeURIComponent(courseFolder)}/${encodeURIComponent(file)}`,
        thumb: getThumbForFile(file), // custom logic
        date: getDateForFile(file), // custom logic
        tags: getTagsForFile(file), // custom logic
      });
    });
});

fs.writeFileSync(
  path.join(coursesDir, 'index.json'),
  JSON.stringify(deliverables, null, 2)
);

    /* ========== UI wiring ========== */
    const galleryEl = document.getElementById('gallery');
    const courseFilterEl = document.getElementById('courseFilter');
    const searchBoxEl = document.getElementById('searchBox');
    const resultCountEl = document.getElementById('resultCount');
    const emptyEl = document.getElementById('emptyState');

    // Build distinct course list + query param support (?course=studio%201)
    const urlParams = new URLSearchParams(location.search);
    const qpCourse = (urlParams.get('course') || '').toLowerCase();

    const courses = Array.from(new Set(deliverables.map(d => d.course.toLowerCase()))).sort();
    courseFilterEl.innerHTML = [
      `<option value="all">All courses</option>`,
      ...courses.map(c => `<option value="${c}">${titleCase(c)}</option>`)
    ].join('');
    if (qpCourse && courses.includes(qpCourse)) courseFilterEl.value = qpCourse;

    // Render
    function render() {
      const q = searchBoxEl.value.trim().toLowerCase();
      const selected = courseFilterEl.value;

      const filtered = deliverables.filter(d => {
        const matchesCourse = selected === 'all' || d.course.toLowerCase() === selected;
        const hay = [d.title, ...(d.tags||[])].join(' ').toLowerCase();
        const matchesSearch = !q || hay.includes(q);
        return matchesCourse && matchesSearch;
      });

      galleryEl.innerHTML = filtered.map(cardHTML).join('');
      resultCountEl.textContent = `${filtered.length} item${filtered.length!==1?'s':''}`;
      emptyEl.hidden = filtered.length !== 0;
    }

    function cardHTML(d){
      const date = d.date ? new Date(d.date).toLocaleDateString(undefined, {year:'numeric', month:'short', day:'2-digit'}) : '';
      const bg = d.thumb ? `style="background-image:url('${d.thumb}')"`: '';
      return `
        <article class="card">
          <div class="card-body">
            <span class="badge">${titleCase(d.course)}</span>
            <h3 class="title">${escapeHTML(d.title)}</h3>
            <div class="meta">${date}</div>
            <div class="card-actions">
              <a class="primary-btn" href="${d.href}">Open</a>
            </div>
          </div>
        </article>`;
    }

    function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
    function titleCase(s){ return s.replace(/\b\w/g, c => c.toUpperCase()); }

    // Events
    courseFilterEl.addEventListener('change', () => {
      const v = courseFilterEl.value;
      const p = new URLSearchParams(location.search);
      if (v==='all') { p.delete('course'); } else { p.set('course', v); }
      history.replaceState({}, '', `${location.pathname}?${p.toString()}`);
      render();
    });
    searchBoxEl.addEventListener('input', render);

    // Initial render
    render();
  </script>
</body>
</html>
